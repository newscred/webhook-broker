openapi: 3.0.0
info:
  title: Webhook Broker API
  description: This is a fully HTTP-based Pub/Sub Broker designed to simplify system architecture in SOA or Microservice architecture.
  version: 1.0.0
paths:
  /producers:
    get:
      summary: Get list of producers
      tags:
        - Producers
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListResult'
        '400':
          description: Bad request
  /producer/{producerId}:
    get:
      summary: Get a specific producer
      tags:
        - Producers
      parameters:
        - name: producerId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MsgStakeholder'
        '404':
          description: Producer not found
    put:
      summary: Update a specific producer
      tags:
        - Producers
      parameters:
        - name: producerId
          in: path
          required: true
          schema:
            type: string
        - name: If-Unmodified-Since
          in: header
          required: false
          schema:
            type: string
          description: Only update if the resource has not been modified since this timestamp
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                token:
                  type: string
                name:
                  type: string
      responses:
        '200':
          description: Successful update
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MsgStakeholder'
        '400':
          description: Bad request
        '404':
          description: Producer not found
        '412':
          description: Precondition failed - resource has been modified
  /channels:
    get:
      summary: Get list of channels
      tags:
        - Channels
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListResult'
        '400':
          description: Bad request
  /channel/{channelId}:
    get:
      summary: Get a specific channel
      tags:
        - Channels
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChannelModel'
        '404':
          description: Channel not found
    put:
      summary: Update a specific channel
      tags:
        - Channels
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: If-Unmodified-Since
          in: header
          required: false
          schema:
            type: string
          description: Only update if the resource has not been modified since this timestamp
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                token:
                  type: string
                name:
                  type: string
      responses:
        '200':
          description: Successful update
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChannelModel'
        '400':
          description: Bad request
        '404':
          description: Channel not found
        '412':
          description: Precondition failed - resource has been modified
  /channel/{channelId}/consumers:
    get:
      summary: Get list of consumers for a channel
      tags:
        - Consumers
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListResult'
        '400':
          description: Bad request
  /channel/{channelId}/consumer/{consumerId}:
    get:
      summary: Get a specific consumer
      tags:
        - Consumers
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: consumerId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsumerModel'
        '404':
          description: Consumer not found
    put:
      summary: Update a specific consumer
      tags:
        - Consumers
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: consumerId
          in: path
          required: true
          schema:
            type: string
        - name: If-Unmodified-Since
          in: header
          required: false
          schema:
            type: string
          description: Only update if the resource has not been modified since this timestamp
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                token:
                  type: string
                name:
                  type: string
                callbackUrl:
                  type: string
                type:
                  type: string
      responses:
        '200':
          description: Successful update
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsumerModel'
        '400':
          description: Bad request
        '404':
          description: Consumer not found
        '412':
          description: Precondition failed - resource has been modified
    delete:
      summary: Delete a specific consumer
      tags:
        - Consumers
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: consumerId
          in: path
          required: true
          schema:
            type: string
        - name: If-Unmodified-Since
          in: header
          required: false
          schema:
            type: string
          description: Only delete if the resource has not been modified since this timestamp
      responses:
        '204':
          description: Successful deletion
        '404':
          description: Consumer not found
        '412':
          description: Precondition failed - resource has been modified
  /_status:
    get:
      summary: Get application status
      tags:
        - Status
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppData'
        '500':
          description: Internal server error
  /job-status:
    get:
      summary: Get job status counts grouped by consumer
      tags:
        - Status
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobStatus'
        '500':
          description: Internal server error
  /channel/{channelId}/consumer/{consumerId}/queued-jobs:
    get:
      summary: Get queued jobs for a consumer
      tags:
        - Jobs
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: consumerId
          in: path
          required: true
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 25
            maximum: 100
        - name: X-Broker-Channel-Token
          in: header
          required: true
          schema:
            type: string
          description: Channel authentication token
        - name: X-Broker-Consumer-Token
          in: header
          required: true
          schema:
            type: string
          description: Consumer authentication token
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobListResult'
        '400':
          description: Bad request
        '401':
          description: Unauthorized - missing or invalid token
        '403':
          description: Forbidden - token does not match
        '412':
          description: Precondition failed
  /channel/{channelId}/consumer/{consumerId}/job/{jobId}/requeue-dead-job:
    post:
      summary: Requeue a dead job for a consumer
      tags:
        - Jobs
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: consumerId
          in: path
          required: true
          schema:
            type: string
        - name: jobId
          in: path
          required: true
          schema:
            type: string
        - name: X-Broker-Channel-Token
          in: header
          required: true
          schema:
            type: string
          description: Channel authentication token
        - name: X-Broker-Consumer-Token
          in: header
          required: true
          schema:
            type: string
          description: Consumer authentication token
      responses:
        '202':
          description: Job requeued successfully
        '400':
          description: Bad request
        '401':
          description: Unauthorized - missing or invalid token
        '403':
          description: Forbidden - token does not match
        '404':
          description: Job not found
        '412':
          description: Precondition failed
  /channel/{channelId}/consumer/{consumerId}/job/{jobId}:
    get:
      summary: Get a specific job
      tags:
        - Jobs
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: consumerId
          in: path
          required: true
          schema:
            type: string
        - name: jobId
          in: path
          required: true
          schema:
            type: string
        - name: X-Broker-Channel-Token
          in: header
          required: true
          schema:
            type: string
          description: Channel authentication token
        - name: X-Broker-Consumer-Token
          in: header
          required: true
          schema:
            type: string
          description: Consumer authentication token
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HyperlinkedDeliveryJobModel'
        '401':
          description: Unauthorized - missing or invalid token
        '403':
          description: Forbidden - token does not match
        '404':
          description: Job not found
        '412':
          description: Precondition failed
    post:
      summary: Update a specific job
      tags:
        - Jobs
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: consumerId
          in: path
          required: true
          schema:
            type: string
        - name: jobId
          in: path
          required: true
          schema:
            type: string
        - name: X-Broker-Channel-Token
          in: header
          required: true
          schema:
            type: string
          description: Channel authentication token
        - name: X-Broker-Consumer-Token
          in: header
          required: true
          schema:
            type: string
          description: Consumer authentication token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                NextState:
                  type: string
                IncrementalTimeout:
                  type: integer
      responses:
        '202':
          description: Job updated successfully
        '400':
          description: Bad request
        '401':
          description: Unauthorized - missing or invalid token
        '403':
          description: Forbidden - token does not match
        '404':
          description: Job not found
        '412':
          description: Precondition failed
    delete:
      summary: Delete a single dead job
      tags:
        - DLQ
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: consumerId
          in: path
          required: true
          schema:
            type: string
        - name: jobId
          in: path
          required: true
          schema:
            type: string
        - name: X-Broker-Channel-Token
          in: header
          required: true
          schema:
            type: string
        - name: X-Broker-Consumer-Token
          in: header
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Dead job deleted successfully
        '403':
          description: Token mismatch
        '404':
          description: Job not found, not dead, or retry not exhausted
  /channel/{channelId}/broadcast:
    post:
      summary: Broadcast a message to a channel
      tags:
        - Broadcast
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: X-Broker-Channel-Token
          in: header
          required: true
          schema:
            type: string
          description: Channel authentication token
        - name: X-Broker-Producer-ID
          in: header
          required: true
          schema:
            type: string
          description: Producer identifier
        - name: X-Broker-Producer-Token
          in: header
          required: true
          schema:
            type: string
          description: Producer authentication token
        - name: X-Broker-Message-ID
          in: header
          required: false
          schema:
            type: string
          description: Optional custom message ID for idempotent broadcasting
        - name: X-Broker-Message-Priority
          in: header
          required: false
          schema:
            type: integer
          description: Message priority (higher value = higher priority)
        - name: X-Broker-Scheduled-For
          in: header
          required: false
          schema:
            type: string
          description: RFC3339 timestamp for scheduled message delivery
        - name: X-Broker-Metadata-Headers
          in: header
          required: false
          schema:
            type: string
          description: Comma-separated list of header names to include as message metadata
      requestBody:
        required: true
        content:
          application/octet-stream:
            schema:
              type: string
      responses:
        '201':
          description: Message broadcasted successfully
        '400':
          description: Bad request
        '401':
          description: Unauthorized - missing or invalid token
        '403':
          description: Forbidden - token does not match
        '409':
          description: Conflict - Duplicate message ID
        '412':
          description: Precondition failed
  /channel/{channelId}/message/{messageId}:
    get:
      summary: Get a specific message
      tags:
        - Messages
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: messageId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageModel'
        '404':
          description: Message not found
  /channel/{channelId}/messages:
    get:
      summary: Get list of messages for a channel
      tags:
        - Messages
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListResult'
        '400':
          description: Bad request
  /channel/{channelId}/messages-status:
    get:
      summary: Get message status counts for a channel
      tags:
        - Messages
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusCount'
        '500':
          description: Internal server error
  /channel/{channelId}/scheduled-messages:
    get:
      summary: Get list of scheduled messages for a channel
      tags:
        - Scheduled Messages
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: status
          in: query
          required: false
          schema:
            type: integer
          description: Filter by scheduled message status
        - name: previous
          in: query
          required: false
          schema:
            type: string
          description: Pagination cursor for previous page
        - name: next
          in: query
          required: false
          schema:
            type: string
          description: Pagination cursor for next page
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListResult'
        '404':
          description: Channel not found
  /channel/{channelId}/scheduled-message/{messageId}:
    get:
      summary: Get a specific scheduled message
      tags:
        - Scheduled Messages
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: messageId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScheduledMessageModel'
        '404':
          description: Scheduled message not found
  /channel/{channelId}/consumer/{consumerId}/dlq:
    get:
      summary: Get dead letter queue for a consumer
      tags:
        - DLQ
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: consumerId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DLQList'
        '404':
          description: Consumer not found
    delete:
      summary: Purge all dead jobs for a consumer
      tags:
        - DLQ
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: consumerId
          in: path
          required: true
          schema:
            type: string
        - name: X-Broker-Channel-Token
          in: header
          required: true
          schema:
            type: string
        - name: X-Broker-Consumer-Token
          in: header
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Dead jobs deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  deletedCount:
                    type: integer
                    format: int64
        '403':
          description: Token mismatch
        '404':
          description: Channel or consumer not found
    post:
      summary: Requeue dead jobs for a consumer
      tags:
        - DLQ
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: consumerId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                requeue:
                  type: string
      responses:
        '202':
          description: Dead jobs requeued successfully
        '400':
          description: Bad request
        '404':
          description: Consumer not found
  /dlq-status:
    get:
      summary: Get DLQ status summary across all consumers
      tags:
        - DLQ
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DLQStatus'
components:
  schemas:
    MsgStakeholder:
      type: object
      properties:
        ID:
          type: string
        Name:
          type: string
        Token:
          type: string
        ChangedAt:
          type: string
          format: date-time
    ListResult:
      type: object
      properties:
        Result:
          type: array
          items:
            type: string
            format: uri
        Pages:
          type: object
          additionalProperties:
            type: string
    ChannelModel:
      type: object
      properties:
        MsgStakeholder:
          $ref: '#/components/schemas/MsgStakeholder'
        ConsumersURL:
          type: string
          format: uri
        MessagesURL:
          type: string
          format: uri
        BroadcastURL:
          type: string
          format: uri
        MessagesStatusURL:
          type: string
          format: uri
        ScheduledMessagesURL:
          type: string
          format: uri
    ConsumerModel:
      type: object
      properties:
        MsgStakeholder:
          $ref: '#/components/schemas/MsgStakeholder'
        CallbackURL:
          type: string
          format: uri
        DeadLetterQueueURL:
          type: string
          format: uri
        Type:
          type: string
    AppData:
      type: object
      properties:
        SeedData:
          type: object
        AppStatus:
          type: object
    JobStatus:
      type: object
      properties:
        <add properties here as per your exact schema>
    JobListResult:
      type: object
      properties:
        Result:
          type: array
          items:
            $ref: '#/components/schemas/QueuedDeliveryJobModel'
    QueuedDeliveryJobModel:
      type: object
      properties:
        ID:
          type: string
        Priority:
          type: integer
        IncrementalTimeout:
          type: integer
        Message:
          $ref: '#/components/schemas/QueuedMessageModel'
    QueuedMessageModel:
      type: object
      properties:
        MessageID:
          type: string
        Payload:
          type: string
        Headers:
          type: object
        ContentType:
          type: string
    HyperlinkedDeliveryJobModel:
      type: object
      properties:
        DeliveryJobModel:
          $ref: '#/components/schemas/DeliveryJobModel'
        MessageURL:
          type: string
          format: uri
        ChannelURL:
          type: string
          format: uri
        ConsumerURL:
          type: string
          format: uri
        ProducerURL:
          type: string
          format: uri
        JobRequeueURL:
          type: string
          format: uri
    DeliveryJobModel:
      type: object
      properties:
        ListenerEndpoint:
          type: string
          format: uri
        ListenerName:
          type: string
        Status:
          type: string
        StatusChangedAt:
          type: string
          format: date-time
    MessageModel:
      type: object
      properties:
        ID:
          type: string
        Payload:
          type: string
        ContentType:
          type: string
        ProducedBy:
          type: string
        ReceivedAt:
          type: string
          format: date-time
        DispatchedAt:
          type: string
          format: date-time
        Status:
          type: string
        Jobs:
          type: array
          items:
            $ref: '#/components/schemas/DeliveryJobModel'
        Headers:
          type: object
    ScheduledMessageModel:
      type: object
      properties:
        id:
          type: string
        messageId:
          type: string
        contentType:
          type: string
        priority:
          type: integer
        producedBy:
          type: string
        dispatchSchedule:
          type: string
          format: date-time
        dispatchedAt:
          type: string
          format: date-time
          nullable: true
        status:
          type: string
        payload:
          type: string
        headers:
          type: object
    StatusCount:
      type: object
      properties:
        Counts:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/TheCount'
          description: Status counts. Scheduled message statuses are prefixed with SCHEDULED_.
        next_scheduled_message_at:
          type: string
          format: date-time
          nullable: true
          description: Timestamp of the next scheduled message due for delivery
    TheCount:
      type: object
      properties:
        Count:
          type: integer
        Links:
          type: object
          additionalProperties:
            type: string
    DLQStatus:
      type: object
      properties:
        consumers:
          type: array
          items:
            $ref: '#/components/schemas/DLQConsumerSummary'
    DLQConsumerSummary:
      type: object
      properties:
        channelId:
          type: string
        channelName:
          type: string
        consumerId:
          type: string
        consumerName:
          type: string
        deadCount:
          type: integer
          format: int64
    DLQList:
      type: object
      properties:
        DeadJobs:
          type: array
          items:
            $ref: '#/components/schemas/DeadDeliveryJobModel'
        Pages:
          type: object
          additionalProperties:
            type: string
    DeadDeliveryJobModel:
      type: object
      properties:
        DeliveryJobModel:
          $ref: '#/components/schemas/DeliveryJobModel'
        MessageURL:
          type: string
          format: uri
        JobRequeueURL:
          type: string
          format: uri
          nullable: true
          minLength: 0
